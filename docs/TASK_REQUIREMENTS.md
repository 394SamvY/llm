# 📋 任务核心要求

> 本文档详细阐述项目的核心任务要求、评分标准和验收标准

---

## 🎯 一句话概括

> **输入一条训诂句，输出它是"假借说明"还是"语义解释"，并给出完整的推理过程和证据链。**

---

## 📖 项目背景

### 训诂学是什么？

训诂学是中国传统语言学的核心，研究古代文献中的词义解释。

### 声训法是什么？

声训法是利用声音相近的字来解释词义的方法，分为两大类：

| 类型 | 中文名 | 特点 | 本质 |
|------|--------|------|------|
| **Type A** | 以声通义法（语义解释） | 音近**义近** | 揭示语源，词义相关 |
| **Type B** | 揭明正借字法（假借说明） | 音近**义远** | 字的替代，词义无关 |

### 核心判定难点

表面上看起来很像的两种训诂句，本质完全不同：

```
"海，晦也" → 语义解释
  - 海因其色黑（晦暗）而得名
  - 海与晦有语义关联（义近）
  - 这是在解释"海"这个词的来源

"崇，终也" → 假借说明  
  - 崇（高大）与终（终结）语义无关（义远）
  - 崇只是借用了终的音
  - 这是在指出"崇"是"终"的借字
```

---

## 🔑 核心任务定义

### 输入

```python
{
    "训诂句": "崇，终也",           # 必须
    "被释字": "崇",                 # 可从训诂句解析
    "释字": "终",                   # 可从训诂句解析
    "原文语境": "崇朝其雨",         # 可选，有助于第五步判断
    "出处": "《诗·邶风·简兮》毛传"  # 可选
}
```

### 输出

```python
{
    "classification": "假借说明",    # 或 "语义解释"
    "confidence": 0.95,              # 置信度 0-1
    "reasoning": {
        "step1_semantic": { ... },   # 语义分析结果
        "step2_phonetic": { ... },   # 语音分析结果
        "step3_textual": { ... },    # 异文检索结果
        "step4_pattern": { ... },    # 训式识别结果
        "step5_context": { ... }     # 语境分析结果
    },
    "final_judgment": "综合分析：义远+音近+有异文+语境支持假借 → 假借说明"
}
```

---

## 📊 五步推理流程（核心）

这是项目的**核心判定逻辑**，智能体必须严格遵循：

### 第一步：语义关联性分析

| 项目 | 说明 |
|------|------|
| **目标** | 判断被释字与释字的本义是否有语义关联 |
| **工具** | 查询《汉语大词典》获取两字的核心义项 |
| **输出** | `义近` / `义远` |
| **判断逻辑** | 义近→倾向语义解释；义远→倾向假借 |

```python
# 示例
被释字: 崇 → 本义: 高大、尊崇
释字: 终 → 本义: 终结、完整
结论: 义远（高大与终结无语义关联）
```

### 第二步：语音对应分析

| 项目 | 说明 |
|------|------|
| **目标** | 验证被释字与释字的上古音是否相近 |
| **工具** | 查询上古音数据（声母、韵部） |
| **输出** | `音近` / `音远` |
| **判断逻辑** | 音近是假借的**必要条件** |

```python
# 示例
崇: 禅母·东部 (*dzruŋ)
终: 章母·东部 (*tuŋ)
结论: 音近（韵部相同，声母同属舌音）
```

### 第三步：异文与文例佐证

| 项目 | 说明 |
|------|------|
| **目标** | 查找被释字与释字的正借替代关系证据 |
| **工具** | 检索词典例句、异文记录、假借标注 |
| **输出** | `有佐证` / `无佐证` |
| **判断逻辑** | 有异文直接证明正借关系 |

```python
# 示例
异文: 《小雅·采绿》作'终朝'，与'崇朝'互为异文
结论: 有佐证（同一词位用不同字形）
```

### 第四步：训诂术语与训式识别

| 项目 | 说明 |
|------|------|
| **目标** | 识别训诂句使用的训释格式 |
| **工具** | 正则表达式匹配 |
| **输出** | 格式名称 + 暗示类型 + 置信度 |
| **判断逻辑** | 某些格式直接判定类型 |

```python
# 直接判假借的格式
"读为" / "读曰" / "当为" / "当作" / "X与Y通"

# 直接判语义的格式
"犹...也" / "谓之" / "X之貌"

# 需综合判断的格式
"A，B也"  # 最基本训式，不能直接判断
```

### 第五步：语境适配度分析

| 项目 | 说明 |
|------|------|
| **目标** | 将本义代入原句，判断语义是否通顺 |
| **工具** | LLM语义理解 |
| **输出** | `支持假借` / `支持语义` / `不确定` |
| **判断逻辑** | 借字本义不通+正字本义通顺→坐实假借 |

```python
# 示例
原句: "崇朝其雨"
崇(高大)代入: "高大早晨下雨" → 不通顺
终(完整)代入: "整个早晨下雨" → 通顺
结论: 支持假借
```

---

## 🧮 综合判定逻辑

### 判定规则表

| 义 | 音 | 异文 | 训式 | 语境 | **判定** | 置信度 |
|:--:|:--:|:--:|:----:|:----:|:--------:|:------:|
| 远 | 近 | 有 | 假借 | 支持假借 | **假借** | ⭐⭐⭐⭐⭐ |
| 远 | 近 | 有 | 不定 | 支持假借 | **假借** | ⭐⭐⭐⭐ |
| 远 | 近 | 无 | 假借 | 支持假借 | **假借** | ⭐⭐⭐⭐ |
| 远 | 近 | 无 | 不定 | 支持假借 | **假借** | ⭐⭐⭐ |
| 远 | 近 | 无 | 不定 | 不确定 | **假借** | ⭐⭐ |
| 近 | 近 | 无 | 语义 | 都通 | **语义** | ⭐⭐⭐⭐ |
| 近 | 近 | 无 | 不定 | 都通 | **语义** | ⭐⭐⭐ |
| 近 | 远 | 无 | 不定 | - | **语义** | ⭐⭐⭐⭐ |

### 核心原则

1. **音近是假借的必要条件**：音远则不可能是假借
2. **义远是假借的重要指标**：义近通常是语义解释
3. **训式可直接判定**：`读为/读曰/当为` 直接判假借
4. **异文是直接证据**：有异文则假借确信度极高
5. **语境是最后验证**：借字本义不通、正字本义通顺

---

## 📝 评分标准

项目最终成绩由以下五个维度评定：

| 维度 | 权重 | 描述 |
|------|:----:|------|
| **1. 领域知识理解** | 20% | 对声训法两种类型、假借本质的理解深度 |
| **2. 系统架构设计** | 20% | 模块化、可扩展性、RAG/Agent集成度 |
| **3. 资源获取利用** | 20% | MDX解析、知识库构建、检索链集成 |
| **4. 智能体设计实现** | 20% | 决策逻辑、工具调用、多轮推理 |
| **5. 识别成功率** | 20% | 对测试集的分类准确率 |

### 加分项

- 对判定步骤的创新改进
- 细粒度分类（超越二分类）
- 可视化界面
- 详细的错误分析

---

## ✅ 验收标准

### 基本要求

1. [ ] 系统能接受训诂句输入
2. [ ] 系统能输出二元分类结果（假借/语义）
3. [ ] 系统能输出完整的五步推理过程
4. [ ] 系统能给出判断的置信度
5. [ ] 系统有基本的评估能力（计算准确率）

### 进阶要求

1. [ ] 真实接入《汉语大词典》数据
2. [ ] 真实接入上古音数据
3. [ ] 实现异文/文例检索
4. [ ] 接入 LLM API 进行语境分析
5. [ ] 构建完整测试数据集（50+条）
6. [ ] 在测试集上达到 70%+ 准确率

### 优秀要求

1. [ ] 实现细粒度分类
2. [ ] 支持网络搜索扩展证据
3. [ ] 可视化推理过程
4. [ ] 详细的错误分析报告
5. [ ] 在测试集上达到 85%+ 准确率

---

## 🎓 测试集说明

### 测试集来源

教师提供的测试集来自参考资料中**未出现**的训诂句。

### 自建测试集

从参考资料 2/3/4 中提取明确标注类型的训诂句：

```python
# 测试用例格式
{
    "id": "test_001",
    "xungu_sentence": "崇，终也",
    "beishi_char": "崇",
    "shi_char": "终",
    "source": "《诗·邶风·简兮》毛传",
    "context": "崇朝其雨",
    "expected_label": "假借说明",
    "explanation": "义远音近，有异文佐证"
}
```

### 参考资料中的示例

**假借说明类：**
- "崇，终也" —— 崇是终的借字
- "正，读为征" —— "读为"直接标明假借
- "女，读曰汝" —— "读曰"直接标明假借
- "蚤，读为爪" —— 蚤借为爪

**语义解释类：**
- "海，晦也" —— 海因晦暗得名（需验证）
- "户，护也" —— 户因保护功能得名
- "星，散也" —— 星因散布天空得名
- "道，導也" —— 道有引导之义

---

## 💡 实现建议

### 推荐开发顺序

1. **先跑通骨架**：确保 Mock 数据下流程完整
2. **实现训式识别**：正则匹配，确定性最高
3. **实现音韵查询**：解析 TXT 数据，相对简单
4. **实现语义查询**：解析 JSONL 字典
5. **实现语境分析**：接入 LLM API
6. **构建测试集**：从参考资料提取
7. **优化和调参**：根据错误分析迭代

### 关键文件

| 文件 | 用途 |
|------|------|
| `dyhdc.parsed.fixed.v2.jsonl` | 字义查询（1.9GB） |
| `音韵数据/上古音/*/` | 语音查询 |
| `src/tools/pattern_tool.py` | 训式识别（已实现） |
| `src/evaluation/test_dataset.py` | 测试数据集 |

---

## 🔗 相关文档

- [快速开始](QUICK_START.md)
- [架构设计](ARCHITECTURE.md)
- [实现指南](IMPLEMENTATION_GUIDE.md)
- [开发计划](DEVELOPMENT_PLAN.md)
